<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>FieloEE__SetGeoLocation</fullName>
    <availability>online</availability>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Set Geo Location</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>{!REQUIRESCRIPT(&quot;/soap/ajax/29.0/connection.js&quot;)}
{!REQUIRESCRIPT(&quot;https://maps.googleapis.com/maps/api/js?v=3&amp;sensor=false&quot;)}

var branchs = sforce.connection.query(&quot;SELECT Id, {!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}Street__c, {!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}City__c, {!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}State__c, {!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}ZipCode__c, {!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}Country__c, {!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}Latitude__c, {!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}Longitude__c FROM {!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}Branch__c WHERE Id = \&apos;{!FieloEE__Branch__c.Id}\&apos; &quot;);
var branch = branchs.getArray(&quot;records&quot;)[0];

var geocoder = new google.maps.Geocoder();
var address =&apos;&apos;;
address += (branch.{!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}Street__c != null)?&apos;,&apos;+branch.{!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}Street__c:&apos;&apos;;
address += (branch.{!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}City__c != null)?&apos;,&apos;+branch.{!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}City__c:&apos;&apos;;
address += (branch.{!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}State__c != null)?&apos;,&apos;+branch.{!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}State__c:&apos;&apos;;
address += (branch.{!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}ZipCode__c != null)?&apos;,&apos;+branch.{!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}ZipCode__c:&apos;&apos;;
address += (branch.{!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}Country__c != null)?&apos;,&apos;+branch.{!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}Country__c:&apos;&apos;;

if(address.length &gt; 0){
address = address.substring(1);

geocoder.geocode( { &apos;address&apos;: address}, function(results, status) {
if (status == google.maps.GeocoderStatus.OK) {
branch.{!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}Latitude__c = results[0].geometry.location.lat();
branch.{!$Setup.FieloEE__PublicSettings__c.FieloEE__PackagePrefix__c}Longitude__c = results[0].geometry.location.lng();
}else{
alert(&apos;{!$Label.fieloee__serviceunavailable}&apos;);
}
var branchUpdate = [];
branchUpdate.push(branch);
result = sforce.connection.update(branchUpdate);
parent.location.href = &quot;{!FieloEE__Branch__c.Id}&quot;;
});
}else{
alert(&apos;{!$Label.fieloee__pleasefilladdressinformation}&apos;);
}</url>
</WebLink>
